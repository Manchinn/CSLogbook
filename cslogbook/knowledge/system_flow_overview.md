# ภาพรวม Flow ระบบ CSLogbook (Production + ขั้นตอนเจ้าหน้าที่ภาควิชา)

> วัตถุประสงค์: สรุปขั้นตอนแบบย่อสำหรับการเตรียมระบบขึ้น Production และลำดับงานหลักที่เจ้าหน้าที่ภาควิชาต้องทำเมื่อเข้าระบบครั้งแรกหลัง deploy

---

## 1. สิ่งที่ต้องพร้อมก่อนขึ้น Production

| ด้าน | รายการตรวจสอบ | รายละเอียด | ผู้รับผิดชอบ |
|------|----------------|-------------|---------------|
| โครงสร้างพื้นฐาน | ✅ Server/VM พร้อม Node.js 18 LTS, npm 9+, MySQL 8, พื้นที่เก็บไฟล์ `uploads/`, HTTPS Reverse Proxy (เช่น Nginx) | ติดตั้งแพ็กเกจระบบ, ตั้งเวลาเครื่องเป็น `Asia/Bangkok`, เปิดพอร์ต 80/443/5000 ตาม design | Infra/DevOps |
| ซอร์สโค้ด | ✅ Checkout branch `master` หรือ release tag ที่อนุมัติแล้ว | ใช้ `git clone` หรือ `git pull` บนเครื่องปลายทาง, ตรวจสอบว่าไม่มีไฟล์ dev-only | DevOps |
| Environment | ✅ กำหนดไฟล์ `.env.production` ทั้งฝั่ง backend และ frontend | อ้างอิง `.env.example`; กรอก `DB_*`, `JWT_*`, `FRONTEND_URL`, `SENDGRID_*`, `UPLOAD_DIR`, และ API URL ให้ตรงโดเมนจริง | DevOps |
| Database | ✅ สร้าง schema + migrate + seed ข้อมูลคงที่ | รัน `npm install`, `npx sequelize-cli db:migrate`, `npx sequelize-cli db:seed:all`; สร้างบัญชี admin/support เริ่มต้น | Backend |
| Build Backend | ✅ รัน `npm run build` (ถ้ามี) และใช้ `npm start` ด้วย process manager (PM2/systemd) | ตรวจ `logs/app.log` เพื่อดู error, เปิด Swagger `/api-docs` ทดสอบ | Backend |
| Build Frontend | ✅ ตั้งค่า `.env.production` แล้ว `npm run build` | Deploy โฟลเดอร์ `build/` ไปยัง Static Host/Reverse Proxy; ตั้งค่า rewrite ไป `index.html` | Frontend |
| CI & Monitoring | ✅ Workflow GitHub Actions เปิดใช้งาน, ตั้งค่า alert/log rotation | ตรวจสถานะ workflow ล่าสุด, ตั้งค่าแจ้งเตือนผ่าน email/Slack, สำรอง `logs/` | DevOps |

> หมายเหตุ: ถ้าต้องการ Blue-Green หรือ Rolling Deploy ให้เตรียมฐานข้อมูลสำรอง และทดสอบแผน rollback (เช่น backup DB, เก็บ artifact build เดิม)

### 1.1 ขั้นตอนย่อยที่ต้องรันบนเครื่อง Production

1. **Backend**  
   ```bash
   cd cslogbook/backend
   npm ci
   npm run build                # ถ้าใช้ transpile
   npx sequelize-cli db:migrate
   npx sequelize-cli db:seed:all
   NODE_ENV=production npm start # หรือใช้ PM2: pm2 start ecosystem.config.js
   ```
   - ตรวจสอบ log ที่ `backend/logs/app.log` และสถานะสุขภาพด้วย `/api/health` (ถ้ามี)
2. **Frontend**  
   ```bash
   cd cslogbook/frontend
   npm ci
   npm run build
   ```
   - นำโฟลเดอร์ `build/` ไปวางหลัง Nginx/Apache และตั้งค่า reverse proxy ไป backend ที่ `/api` + `/uploads`
3. **Static & File Uploads**  
   - สร้างโฟลเดอร์ `uploads/` พร้อมสิทธิ์เขียน/อ่านที่ user รัน backend เข้าถึงได้  
   - ตั้ง cron สำรองข้อมูลไฟล์และฐานข้อมูลตามรอบที่ต้องการ

---

## 2. Flow หลักสำหรับเจ้าหน้าที่ภาควิชาหลังระบบพร้อมใช้งาน

> ผู้ใช้งานเป้าหมาย: เจ้าหน้าที่ภาควิชาที่มีบทบาท Support/Admin (teacher_type = `support`)

### Step A: เข้าสู่ระบบและตรวจสอบสิทธิ์
1. เข้าหน้าเว็บ Production ของ CSLogbook → ปุ่ม "เข้าสู่ระบบ"
2. ใช้บัญชี Support Staff ที่ทีม Dev สร้างไว้ (มีสิทธิ์ Admin Settings)
3. ตรวจสอบว่ามีเมนู "การตั้งค่าระบบ" (Admin Settings) แสดงครบ เช่น หลักสูตร, ปีการศึกษา, การอัปโหลดนักศึกษา

### Step B: ตั้งค่าหลักสูตร (Curriculum)
1. ไปที่เมนู **ตั้งค่าระบบ → หลักสูตร**
2. ตรวจสอบรายการหลักสูตรที่ seed มา (เช่น CS2565, CS2568)
3. หากมีหลักสูตรใหม่:
   - คลิกปุ่ม **"เพิ่มหลักสูตร"**
   - กรอกข้อมูลหลักสูตร: รหัส, ชื่อเต็ม, ชื่อย่อ, หน่วยกิต, เกณฑ์หน่วยกิตฝึกงาน/โครงงาน, สถานะ Active
   - บันทึก → ตรวจสอบว่าปรากฏในรายการและ Active ถูกต้อง
4. ถ้าต้องการปรับหลักสูตรเดิมให้ Active → กดแก้ไข แล้วตั้งสถานะ "ใช้งาน" (ระบบควรมี Active หลักสูตรเดียวในช่วงสมัย)

### Step C: ตั้งค่าปีการศึกษาและภาคเรียน (Academic Settings)
1. เข้าเมนู **ตั้งค่าระบบ → ปีการศึกษา/ภาคเรียน**
2. กด **"สร้าง/แก้ไขปีการศึกษา"** เพื่อกำหนด:
   - ปีการศึกษา (เช่น 2568)
   - ภาคเรียนปัจจุบัน (1/2/3)
   - วันที่เริ่ม-สิ้นสุดภาคเรียน
   - ช่วงเวลาการยื่นคำร้องฝึกงาน/โครงงาน (start/end)
3. บันทึกและตรวจสอบว่า `is_current` = true สำหรับเรคคอร์ดใหม่
4. (ถ้ามี) ตั้งค่า deadline สำคัญในเมนู **Important Deadlines** ให้ตรงกับปี/เทอมที่เพิ่งสร้าง

### Step D: ปรับเกณฑ์คุณสมบัติ (ถ้าต้องใช้)
1. เปิดเมนู **การตั้งค่าคุณสมบัติฝึกงาน/โครงงาน**
2. เลือกหลักสูตร Active แล้วกำหนด:
   - ชั้นปีขั้นต่ำ, หน่วยกิตสะสมขั้นต่ำ (รวม & วิชาภาค)
   - จำนวนชั่วโมง/วันฝึกงานขั้นต่ำ
   - เงื่อนไขเพิ่มเติม (ต้องผ่านฝึกงานก่อนทำโครงงาน ฯลฯ)
3. บันทึก → ระบบ Agent (`eligibilityUpdater`) จะใช้อ้างอิงตอนตรวจสิทธิ์นักศึกษา

### Step E: อัปโหลดรายชื่อนักศึกษา (Bulk Upload)
1. ไปที่เมนู **จัดการผู้ใช้ → นักศึกษา → อัปโหลดเป็นกลุ่ม (Bulk Upload)**
2. ดาวน์โหลด template (CSV/XLSX) จากระบบ เพื่อให้ฟิลด์ตรงกัน เช่น:
   - `student_id`, `first_name`, `last_name`, `email`, `curriculum_code`, `entry_year`, `status`
3. เตรียมไฟล์รายชื่อนักศึกษาชุดแรกให้ครบถ้วน → บันทึกเป็น CSV/Excel ตามที่ระบบรองรับ
4. คลิก **"เลือกไฟล์" → Upload**
5. ระบบจะแสดงผลตัวอย่างและสรุปจำนวนรายการที่จะสร้าง/อัปเดต
6. กดยืนยัน → ตรวจสอบผลลัพธ์ (รายการสำเร็จ/ผิดพลาด)
7. หากมี error (เช่น curriculum_code ไม่ตรง) ให้แก้ไฟล์และอัปโหลดใหม่

### Step F: ตรวจสอบข้อมูลหลังอัปโหลด
1. ตรวจสอบในตารางนักศึกษาว่ามีข้อมูลครบและผูกกับหลักสูตร/ปีการศึกษาถูกต้อง
2. สุ่มเปิดโปรไฟล์นักศึกษาเพื่อเช็กสถานะ eligibility, timeline, menu ต่างๆ
3. แจ้งทีมงาน/อาจารย์ที่เกี่ยวข้องว่าระบบพร้อมให้นักศึกษาเข้าสู่ระบบ

---

## 3. Checklist สั้นๆ ก่อนเปิดให้นักศึกษาใช้งานจริง

- [ ] Backend + Database พร้อม, API `/api/health` ตอบ 200
- [ ] Frontend build ติดตั้งเสร็จ, ทดสอบเมนูหลักครบทั้ง Admin/Student
- [ ] หลักสูตร Active ถูกต้อง, ปีการศึกษา/ภาคเรียนปัจจุบันตั้งแล้ว
- [ ] รายชื่อนักศึกษาอัปโหลดครบ, สุ่มตรวจ 5 รายแล้วผ่าน
- [ ] กำหนดเส้นตาย/แจ้งเตือนเร่งด่วน (Important Deadlines, Notification Settings)
- [ ] อีเมลระบบทดสอบส่งได้ (SendGrid หรือช่องทางที่เลือก)
- [ ] สำรองข้อมูล seed/template เก็บไว้ และจดบันทึกขั้นตอน rollback

---

## 4. คำแนะนำเพิ่มเติมหลังเปิดใช้งาน

1. ตั้ง Cron/Agent ให้รัน `eligibilityUpdater` ตามรอบ (เช่น ทุกเที่ยงคืน) เพื่อรีเฟรชสิทธิ์นักศึกษา
2. เปิด GitHub Actions CI เพื่อตรวจสอบ build/test เมื่อมีการ patch hotfix
3. จัดอบรมสั้นให้เจ้าหน้าที่ภาควิชาเกี่ยวกับการแก้ไขหลักสูตร/ภาคเรียนเมื่อมีการเปลี่ยนเทอมใหม่
4. เก็บ ticket feedback จากนักศึกษา/อาจารย์ในช่วง 1-2 สัปดาห์แรกเพื่อปรับปรุง flow

---

## 5. Flow หลักสำหรับนักศึกษา (Student Journey)

> ผู้ใช้งานเป้าหมาย: นักศึกษาปริญญาตรีที่ต้องดำเนินกระบวนการฝึกงานผ่าน CSLogbook

### Step S1: เตรียมความพร้อมก่อนเริ่ม (First Login & Eligibility)
1. เข้าหน้าเว็บ Production → ปุ่ม "เข้าสู่ระบบ" แล้วเลือกบัญชี **นักศึกษา**
2. ตรวจสอบข้อมูลโปรไฟล์ที่ระบบซิงก์จากทะเบียน (ชื่อ-สกุล, อีเมล, หลักสูตร) ว่าถูกต้อง
3. เปิดหน้า Dashboard/Eligibility เพื่อตรวจสอบว่าผ่านเกณฑ์ฝึกงานหรือไม่ (อ้างอิงข้อมูลจากหลักสูตรที่เจ้าหน้าที่ตั้งค่าไว้)
4. หากไม่ผ่าน ให้ดูรายละเอียดเกณฑ์ที่ขาด แล้วดำเนินการตามคำแนะนำ (เช่น หน่วยกิตไม่ครบ → ติดต่อภาควิชา)

### Step S2: ยื่นคำร้อง คพ.05 (Internship Application)
1. ไปที่เมนู **ฝึกงาน → ยื่นคำร้อง คพ.05**
2. กรอกแบบฟอร์มออนไลน์ให้ครบ: ข้อมูลบริษัท, ผู้ประสานงาน, ช่วงเวลาฝึกงาน, แนบไฟล์ประกอบ (ถ้ามี)
3. ตรวจสอบก่อนส่ง (ระบบจะแจ้งช่องที่ยังไม่ครบ) แล้วกด **ส่งคำร้อง**
4. ระบบจะแสดงสถานะคำร้อง (รอพิจารณา, อนุมัติ, ไม่อนุมัติ) และส่งอีเมลยืนยันให้ผู้เกี่ยวข้อง

### Step S3: ติดตามสถานะการอนุมัติ
1. กลับไปที่หน้า **ติดตามคำร้อง** เพื่อตรวจดูสายงานอนุมัติ (เจ้าหน้าที่ภาค → หัวหน้าภาค)
2. หากถูก **ไม่อนุมัติ** ระบบจะแสดงเหตุผล → สามารถแก้ไขแบบฟอร์มแล้วส่งใหม่ได้
3. เมื่อ **อนุมัติแล้ว** ให้บันทึกอีเมลยืนยันไว้เป็นหลักฐาน และรอหนังสือรองรับ/ขั้นตอนถัดไปจากเจ้าหน้าที่ (ปัจจุบันบางขั้นตอนยังดำเนินการแบบ Manual)

### Step S4: จัดการช่วงฝึกงาน (Logbook & เอกสารระหว่างฝึกงาน)
1. หลังได้รับอนุมัติ → ไปที่เมนู **บันทึกการฝึกงาน (Logbook)**
2. สร้างบันทึกรายวัน: เวลาเข้า-ออก, รายละเอียดงาน, ปัญหาที่พบ, ชั่วโมงการทำงาน
3. ส่งบันทึกเพื่อให้อาจารย์ที่ปรึกษา/ผู้ควบคุมอนุมัติ (ระบบจะแสดงสถานะอนุมัติของแต่ละรายการ)
4. สามารถแนบไฟล์ประกอบ (รูป/เอกสาร) ได้ตามนโยบายภาควิชา

### Step S5: สิ้นสุดการฝึกงานและสรุปผล
1. ไปที่เมนู **สรุปผล/Reflection** เพื่อกรอกสิ่งที่ได้เรียนรู้, ทักษะที่พัฒนา, ข้อเสนอแนะ
2. ตรวจสอบว่าบันทึก Logbook ครบตามจำนวนวัน/ชั่วโมงขั้นต่ำแล้ว
3. ดาวน์โหลดรายงานสรุป (ถ้าระบบเปิดให้ดาวน์โหลด) หรือเตรียมส่งให้เจ้าหน้าที่ตามคำแนะนำ
4. ระบบจะรอคะแนนประเมินจากพี่เลี้ยง (หากใช้ Supervisor Evaluation Link) และนำไปแสดงในหน้าสรุปผล

### Step S6: หลังส่งสรุปผล (Roadmap อนาคต)
- ระยะต่อไป ระบบจะเปิดให้ติดตามสถานะตรวจเอกสาร, ขอใบรับรองการฝึกงาน, และดาวน์โหลดเอกสารสำคัญได้จากเมนูเดียว (ปัจจุบันบางส่วนยังเป็น Manual)
- แนะนำให้เก็บสำเนา Logbook/Reflection ไว้เอง และติดตามประกาศภาควิชาเรื่องการรับเอกสารจริง

### ส่วนเสริม: เส้นทางโครงงานพิเศษ (Capstone Project Journey)
> สำหรับนักศึกษาที่จะเริ่มโครงงานพิเศษ/ปริญญานิพนธ์ โดยระบบใช้ workflow ใกล้เคียงฝึกงานและผูกกับเมนู **โครงงานพิเศษ (Project)**

1. **Capstone-P1: ตรวจคุณสมบัติและสร้างโปรเจค**  
   - เปิดเมนู **โครงงานพิเศษ → ภาพรวมโครงงาน** เพื่อตรวจ readiness cards (หน่วยกิตรวม, หน่วยกิตวิชาภาค, ชั้นปี, logbook meeting ฯลฯ)  
   - หากผ่านเกณฑ์ ให้กดเริ่มโครงงานและกรอกข้อมูลพื้นฐาน (หัวข้อไทย/อังกฤษ, สมาชิก, ที่ปรึกษา)

2. **Capstone-P2: ยื่นข้อเสนอ KP01**  
   - ไปที่แท็บ **เอกสาร/คำขอ** → อัปโหลดไฟล์ KP01 และเอกสารประกอบ  
   - ระบบแจ้งเตือนให้อาจารย์ที่ปรึกษาอนุมัติ (ต้องครบทุกคน) และล็อกเวอร์ชันเมื่ออนุมัติแล้ว

3. **Capstone-P3: สอบหัวข้อและปรับขอบเขต**  
   - เจ้าหน้าที่จะนัดสอบข้อเสนอ (Proposal Defense) และแสดงรายละเอียดใน timeline  
   - หลังสอบ หากกรรมการกำหนดให้ปรับ scope ให้กลับมายื่นเอกสารปรับปรุงในหน้าเดียวกันจนกว่าจะได้รับอนุมัติ

4. **Capstone-P4: ขอสอบโครงงานพิเศษ 1 (KP02 – Project1)**  
   - ใช้ฟอร์ม **ยื่น KP02 โครงงานพิเศษ 1** เพื่อยืนยันความพร้อม (แนบไฟล์บท 1-3 / ใบเซ็นจริงตามที่ภาควิชากำหนด)  
   - ระบบตรวจ checklist (สมาชิกครบ, meeting ผ่านเกณฑ์) แล้วส่งให้อาจารย์และเจ้าหน้าที่รับรอง → เมื่อพร้อมจะขึ้นสถานะ “เตรียมสอบ Project1” และแสดงนัดหมายสอบเมื่อเจ้าหน้าที่จัดตาราง

5. **Capstone-P5: คำขอล่วงหน้า 30 วัน + ยื่นสอบปริญญานิพนธ์**  
   - หลังสอบ Project1 ผ่าน ให้ยื่น **30-Day Request** เพื่อแจ้งวันสอบปริญญานิพนธ์ที่คาดหวัง (ระบบตรวจว่าถูกต้อง ≥ 30 วัน)  
   - ครบกำหนดแล้วจึงยื่น KP02 รอบปริญญานิพนธ์ พร้อมไฟล์เล่มสมบูรณ์และเอกสารประกอบ → เจ้าหน้าที่ตรวจความครบถ้วนก่อนนัดสอบ

6. **Capstone-P6: สอบปริญญานิพนธ์ แก้ไข และปิดโครงงาน**  
   - หลังสอบ โครงงานจะบันทึกผล (Pass / Minor / Major / Fail) ในระบบ  
   - ถ้าต้องแก้เนื้อหา/รูปเล่ม ให้ส่งไฟล์แก้ไขตามลำดับ (Content → Formatting) จนสถานะได้รับอนุมัติ  
   - เมื่อทุกขั้นผ่านครบ ระบบจะเปลี่ยนสถานะเป็น **Completed** และเตรียมข้อมูลสำหรับออกใบรับรอง/รายงานในอนาคต

> เคล็ดลับ: ใช้หน้า Timeline และ Meeting Logbook ในโมดูลโครงงานเพื่อติดตามสิ่งที่ต้องทำต่อไป, ตั้งเตือน deadline และเก็บไฟล์สำคัญในระบบเพื่อลดการสับสนเวอร์ชัน

---

## 6. Flow หลักสำหรับอาจารย์ที่ปรึกษา/ผู้ควบคุมการฝึกงาน (Advisor/Supervisor Journey)

> ผู้ใช้งานเป้าหมาย: อาจารย์ในภาควิชาหรือผู้ควบคุมฝึกงานที่ได้รับมอบหมายดูแลนักศึกษากลุ่มหนึ่ง

### Step T1: เข้าสู่ระบบและตรวจสอบนักศึกษาในความดูแล
1. ล็อกอินด้วยบัญชีอาจารย์ (role `teacher`, `teacherType` = advisor/coordinator)
2. ที่หน้า Dashboard จะเห็นรายชื่อนักศึกษาที่อยู่ในความดูแล พร้อมสถานะล่าสุด (คำร้องฝึกงาน, Logbook, Reflection)
3. ตรวจสอบว่ามีการเชื่อมโยงนักศึกษาถูกต้อง หากพบรายการหายให้แจ้งเจ้าหน้าที่ภาควิชา

### Step T2: พิจารณาคำร้อง คพ.05
1. เปิดเมนู **อนุมัติคำร้องฝึกงาน** หรือรายการแจ้งเตือนใหม่
2. อ่านรายละเอียดที่นักศึกษากรอก พร้อมไฟล์แนบ
3. กด **อนุมัติ** หรือ **ไม่อนุมัติ** พร้อมบันทึกเหตุผล (ระบบจะส่งอีเมลให้นักศึกษาอัตโนมัติ)
4. หากคำร้องต้องแก้ไข ให้ชี้แจงจุดที่ต้องปรับเพื่อให้นักศึกษาส่งใหม่ได้ถูกต้อง

### Step T3: ตรวจสอบและอนุมัติ Logbook
1. เข้าหน้า **Logbook นักศึกษา** แล้วกรองตามชื่อ/รหัสประจำตัว
2. อ่านบันทึกแต่ละวัน → กดอนุมัติ (Approve) หรือปฏิเสธ (Reject) พร้อมความคิดเห็น
3. สามารถอนุมัติหลายรายการพร้อมกันได้เมื่อข้อมูลครบถ้วน (UI จะเปิดให้กดเลือกหลายรายการ)
4. ติดตามนักศึกษาที่ค้างอนุมัติ เพื่อไม่ให้ชั่วโมงฝึกงานตกหล่น

### Step T4: ประเมินผลการฝึกงาน (Supervisor Evaluation – สำหรับพี่เลี้ยงภายนอก)
1. พี่เลี้ยงในสถานประกอบการเข้าสู่ลิงก์ประเมินออนไลน์ที่ระบบส่งให้ (หน้า **ประเมินนักศึกษา** หรือฟอร์มภายนอกที่เชื่อมกับระบบ)
2. กรอกคะแนนตาม rubric ที่กำหนด (performance, discipline, soft skill ฯลฯ) พร้อมความคิดเห็นสำหรับนักศึกษา
3. บันทึกผล → ระบบจะอัปเดตสถานะและสรุปคะแนนให้เจ้าหน้าที่ภาควิชาทราบ ขณะที่อาจารย์ที่ปรึกษาเฝ้าติดตามความคืบหน้าและประสานเมื่อพี่เลี้ยงยังไม่ส่งผลประเมิน

### Step T5: สนับสนุนหลังจบการฝึกงาน (บทบาทพี่เลี้ยง/สถานประกอบการ)
1. พี่เลี้ยงสามารถตรวจสอบแบบสรุป Reflection ที่นักศึกษาส่งเพื่อให้ feedback เพิ่มเติมหากกระบวนการของภาควิชาต้องการ
2. ในกรณีที่ระบบเปิดให้ดาวน์โหลดหรือรับรองใบประกาศ ให้พี่เลี้ยงหรือฝ่ายบุคคลของบริษัทดำเนินการตามคำขอของนักศึกษา (เช่น เซ็นรับรองใบรับรองฝึกงาน)
3. เมื่อพบประเด็นพิเศษ (นักศึกษาชั่วโมงไม่ครบ, ปัญหาจากบริษัท) ให้พี่เลี้ยงประสานเจ้าหน้าที่ภาควิชาและอาจารย์ที่ปรึกษา โดยอาจารย์ทำหน้าที่เป็นผู้ประสานกลาง

### Step T6: เครื่องมือเสริมและงานที่อยู่ใน Roadmap
- ระบบ Meeting/Logbook Approval สำหรับโครงงานอยู่ในอีกโมดูลหนึ่ง (Project) → สามารถติดตามผ่านเมนู Project Meetings ได้
- ฟีเจอร์แจ้งเตือนอัตโนมัติ (Push/Email) สำหรับ Logbook ที่รออนุมัติและ Reflection ใหม่อยู่ระหว่างการปรับปรุง เพื่อช่วยให้ไม่พลาดงานค้าง
- หากต้องการรายงานรวมของนักศึกษาทั้งกลุ่ม สามารถติดต่อเจ้าหน้าที่ภาควิชาเพื่อส่งออกข้อมูลจากหน้ารายงานชั่วคราว
